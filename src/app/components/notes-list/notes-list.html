<div class="filter-header-section">
  <mat-form-field appearance="outline" class="filter-dropdown">
    <mat-label>ğŸ” Î¦Î¹Î»Ï„ÏÎ¬ÏÎ¹ÏƒÎ¼Î± Î±Î½Î¬ Î•Ï€Î¹ÏƒÏ„Î®Î¼Î·</mat-label>
    <mat-select [(ngModel)]="selectedCategory" (selectionChange)="triggerChangeDetection()">
      @for (cat of filterOptions; track cat) {
      <mat-option [value]="cat">{{cat}}</mat-option>
    }
    </mat-select>
  </mat-form-field>
</div>

<div style="display: flex; flex-wrap: wrap; gap: 20px; margin-top: 20px; align-items: flex-start; padding: 20px;">
    
    <mat-card *ngFor="let note of getFilteredNotes()" 
              (click)="openNote(note)" 
              style="width: 340px; height: auto; display: flex; flex-direction: column; border-radius: 12px; overflow: hidden; cursor: pointer; border: 1px solid #eee; transition: all 0.3s ease;">
      
      <mat-card-header style="padding: 16px;">
        <div mat-card-avatar class="author-avatar">
          <span class="avatar-letter">
            {{ (note.author?.username?.charAt(0) || 'U').toUpperCase() }}
          </span>
        </div>
        <mat-card-title style="font-weight: bold; font-size: 1.2rem; color: #1976d2; word-break: break-word;">
          {{ note.title }}
        </mat-card-title>
        <mat-card-subtitle style="font-weight: 500; color: #666;">
          Î‘Ï€ÏŒ: {{ $any(note.author)?.username }}
        </mat-card-subtitle>
      </mat-card-header>
      
      <mat-card-content style="padding: 0 16px 12px 16px;">
        <div class="category-pill-container">
          <span class="category-pill">
            {{ note.category || 'Î“ÎµÎ½Î¹ÎºÏŒ' }}
          </span>
        </div>

        <p style="
          margin: 0; 
          line-height: 1.5; 
          color: #444; 
          font-size: 1rem;
          word-break: break-word;
          white-space: pre-wrap;
        ">
          {{ note.content }}
        </p>
      </mat-card-content>

      <mat-card-actions style="display: flex; justify-content: space-between; align-items: center; padding: 8px 16px; background: #fafafa; border-top: 1px solid #f5f5f5;">
        <span style="font-size: 0.8rem; color: #888;">
          {{ note.createdAt | date:'dd/MM/yyyy' }}
        </span>

        <div style="display: flex; gap: 4px;">    
          <ng-container *ngIf="isAuthor(note)">
            <button mat-icon-button color="primary" (click)="$event.stopPropagation()" [routerLink]="['/edit-note', note._id]">
              <mat-icon>edit</mat-icon>
            </button>

            <button mat-icon-button color="warn" (click)="$event.stopPropagation(); deleteNote(note._id!)">
              <mat-icon>delete</mat-icon>
            </button>
          </ng-container>
        </div>
      </mat-card-actions>
    </mat-card>

    <div *ngIf="getFilteredNotes().length === 0" style="width: 100%; text-align: center; padding: 50px; color: #999;">
      <mat-icon style="font-size: 48px; width: 48px; height: 48px;">sentiment_dissatisfied</mat-icon>
      <p>Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ ÏƒÎ·Î¼ÎµÎ¹ÏÏƒÎµÎ¹Ï‚ Î³Î¹Î± Ï„Î·Î½ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î± "{{selectedCategory}}"</p>
    </div>
</div>