<div class="register-wrapper">
  <div class="register-card">
    <div class="header">
      <h4>Create Account üöÄ</h4>
      <p>Fill in your details to get started</p>
    </div>

    <form [formGroup]="form" class="register-form">
      <mat-form-field appearance="outline">
        <mat-label>Username</mat-label>
        <input matInput formControlName="username">
        <mat-icon matSuffix>person</mat-icon>
        <mat-error>Username is required</mat-error>
      </mat-form-field>

      <div class="row-fields">
        <mat-form-field appearance="outline">
          <mat-label>Firstname</mat-label>
          <input matInput formControlName="firstname">
        </mat-form-field>
        <mat-form-field appearance="outline">
          <mat-label>Lastname</mat-label>
          <input matInput formControlName="lastname">
        </mat-form-field>
      </div>

      <mat-form-field appearance="outline">
        <mat-label>Email</mat-label>
        <input matInput formControlName="email">
        <mat-icon matSuffix>email</mat-icon>
        <mat-error>Please enter a valid email</mat-error>
      </mat-form-field>

      <div class="section-box" formGroupName="address">
        <span class="section-title">üìç Address</span>
        <div class="row-fields mt-2">
          <mat-form-field appearance="outline">
            <mat-label>Area</mat-label>
            <input matInput formControlName="area">
          </mat-form-field>
          <mat-form-field appearance="outline">
            <mat-label>Street</mat-label>
            <input matInput formControlName="street">
          </mat-form-field>
        </div>
      </div>

      <div class="section-box" formArrayName="phone">
        <span class="section-title">üìû Phone Numbers</span>
        @for (p of phone.controls; let i=$index; track i){
          <div [formGroupName]="i" class="phone-row mt-2">
            <mat-form-field appearance="outline">
              <mat-label>Type</mat-label>
              <mat-select formControlName="type">
                <mat-option value="mobile">Mobile</mat-option>
                <mat-option value="work">Work</mat-option>
                <mat-option value="home">Home</mat-option>
              </mat-select>
            </mat-form-field>

            <mat-form-field appearance="outline" class="flex-grow">
              <mat-label>Number</mat-label>
              <input matInput formControlName="number">
            </mat-form-field>

            <div class="action-buttons d-flex">
              @if(phone.controls.length > 1 && i !== 0) {
                <button mat-icon-button color="warn" type="button" (click)="deletePhoneNumber(i)">
                  <mat-icon>remove_circle</mat-icon>
                </button>
              }
              @if(phone.controls[i].valid) {
                <button mat-icon-button color="primary" type="button" (click)="addPhoneNumber()">
                  <mat-icon>add_circle</mat-icon>
                </button>
              }
            </div>
          </div>
        }
      </div>

      <div class="row-fields">
        <mat-form-field appearance="outline">
          <mat-label>Password</mat-label>
          <input matInput type="password" formControlName="password">
        </mat-form-field>

        <mat-form-field appearance="outline">
          <mat-label>Confirm Password</mat-label>
          <input matInput type="password" formControlName="confirmPassword">
          @if(form.get('confirmPassword')?.hasError('passwordMismatch')){
            <mat-error>Passwords don't match!</mat-error>
          }
        </mat-form-field>
      </div>

      <button mat-flat-button class="submit-btn" type="button" (click)="onSubmit()" [disabled]="form.invalid">
        Create Account ‚ú®
      </button>
    </form>
  </div>
</div>